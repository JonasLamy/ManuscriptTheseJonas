% !TEX root = ../my-thesis.tex
%

\chapter{Introduction}
\label{sec:introduction}

\cleanchapterquote{Un petit chapitre pour le doctorant, un grand chapitre pour l'humanité}{Doctorant anonyme}{(Citation temporaire)}

Cette thèse s'inscrit dans le cadre du traitement d'images médicales. Il s'agit avant tout d'une thèse d'analyse d'images avec une teinte de biologie puisque les problématiques rencontrées durant son élaboration découlent directement de considérations anatomiques.

Le sujet de cette thèse est l'analyse de filtres de rehaussement de vaisseaux sanguins pour l'imagerie médicale 3D. L'objectif initial était de comparer ces filtres pour concevoir des outils de segmentation à destination de l'imagerie 3D du foie. Cet objectif a ensuite évolué pour se concentrer sur le développement d'outils d'analyse et d'évaluation de filtres de rehaussement de vaisseaux dans un cadre reproductible. En effet, ces filtres constituent une brique essentielle de la segmentation, mais peu de travaux portent sur la seule évaluation de leurs propriétés.

Dans cette introduction, nous décrivons le contexte global de la thèse ainsi que ses principaux apports.

\section{Contexte global}
% quelques chiffres pour saisir l'importance du foie


Le foie est l'un des organes les plus importants du corps humain. Il participe à de nombreuses fonctions vitales telles que la digestion, l'élimination des déchets ou la gestion de la glycémie. Les maladies liées au foie sont responsables de deux millions de morts par an \cite{Asrani2019_liver_deseases}. On estime en effet à un million le nombre de morts par complications dûes à la cirrhose, une maladie liée à l'apparition de tissus fibreux dans le foie. Un second million de décès est lié à une inflammation aigüe ou chronique du foie, l'hépatite, ainsi qu'au cancer du foie (carcinome). La cirrhose et le cancer du foie sont les $11^{ème}$ et $16^{ème}$ causes de mortalité à travers le monde. Deux de ces pathologies, la cirrhose et l'hépatite chronique, sont le plus souvent liées à une consommation régulière d'alcool. 

Dans ce contexte, le diagnostic et le suivi des maladies du foie sont des objectifs cruciaux pour les médecins. Les techniques d'imagerie non invasives ont considérablement révolutionné ces deux tâches en permettant d'observer l'anatomie interne des patients sans avoir recours à la chirurgie. Pour le foie, deux types d'imagerie sont particulièrement utilisés, la tomodensitométrie (TDM) et l'imagerie par résonance magnétique (IRM). La tomodensitométrie, inventée par Hounsfield en 1972 permet de mesurer l'absorption de rayons X par les tissus du patient. Cette acquisition se fait par coupes successives et permet de reconstituer de manière numérique une représentation 3D des organes. L'IRM est basée sur une machine d'apparence similaire, mais repose sur l'utilisation d'une toute autre technologie qui utilise le champ magnétique. Lors d'une IRM, on mesure le temps de précession des tissus, c'est-à-dire le temps de changement de leur orientation magnétique après une exposition brève et intense à un champ magnétique. Le fonctionnement détaillé de ces deux modalités est explicité dans ce manuscrit. Cette mesure permet ensuite de reconstituer un volume 3D des organes. La première machine IRM permettant l'acquisition d'un corps humain a été développée en 1977 par Damasian. 

Des agents de contraste, permettant de faire ressortir des tissus habituellement invisibles ou pauvrement contrastés comme les vaisseaux, peuvent être utilisés pour les deux modalités (la pratique est cependant bien plus courante en IRM). Pour la tomodensitométrie, on utilise des agents à base d'iode alors que des agents à base de gadolinium sont utilisés pour l'IRM. L'agent est injecté par voie intraveineuse, ce qui ajoute une difficulté supplémentaire lors de l'acquisition des images. En effet, le radiologue doit estimer correctement le temps de propagation du produit de contraste. Si l'image est acquise trop tôt, l'agent de contraste n'a pas le temps de se répandre dans le réseau vasculaire. Si l'image est acquise trop tard, l'agent de contraste se répand dans la totalité de l'organe rendant toute visualisation des vaisseaux impossible. En IRM, on réalise en général plusieurs acquisitions (avant, pendant et après) de manière à fournir un maximum d'informations au radiologue.
Les deux techniques d'imagerie sont complémentaires. La tomodensitométrie offre une grande résolution spatiale et permet de visualiser plus finement les détails, mais elle souffre d'un contraste entre les tissus plus faible. Au contraire, l'IRM possède une plus grande résolution de contraste, mais avec une résolution spatiale plus limitée que la TDM. C'est le médecin radiologue qui a la charge de choisir la méthode la plus appropriée. Pour les vaisseaux du foie, les deux systèmes sont utilisés. Cependant, la doctrine médicale est d'exposer le moins possible un patient à un examen à risque, tel que le rayonnement ionisant émis par la tomodensitométrie. Il y a donc une utilisation croissante de la tomodensitométrie à faible dose de rayons X et de l'IRM, moins agressive que la tomodensitométrie. En contrepartie, l'extraction automatique des vaisseaux pour visualiser les réseaux vasculaires nécessite des algorithmes de plus en plus performants.


\section{Objectifs initiaux et projet ANR}
\label{sec:introduction:objectifs}
% Présentation du projet ANR

Cette thèse a été proposée dans le cadre du projet R-Vessel-X \footnote{\url{http://tgi.ip.uca.fr/r-vessel-x/}} lancé en janvier 2019. Le projet est porté par Antoine Vacavant de l'Institut Pascal en Auvergne Rhône-Alpe. R-Vessel-X a pour objectif l'extraction de vaisseaux sanguins du foie dans les images biomédicales. Un point clé du projet est de proposer des algorithmes robustes. Cette notion de robustesse est à prendre au sens large et regroupe :

\begin{itemize}
\item la résistance des modèles utilisés pour représenter et extraire les vaisseaux face à des changements de tailles, de formes ou d'intensités ;
\item la fidélité des segmentations par rapport aux données originales et la possibilité de corriger celles-ci par les médecins ;
\item la validation des solutions développées grâce à des mesures effectuées sur des données synthétiques, cliniques et un retour de médecins ;
\item la dissémination des algorithmes et des données du projet afin d'assurer une pérennité de ces travaux et une réutilisation par la communauté.
\end{itemize}

Le projet R-Vessel-X rassemble quatre laboratoires de traitement d'images pour travailler sur ces thématiques (Fig. \ref{fig:labs}). Chaque laboratoire se différencie par une expérience particulière. Le LIRIS de l'Université de Lyon et le LORIA de l'Université de Lorraine apportent leur expertise sur l'analyse d'image par géométrie discrète et contribuent à développer la recherche reproductible. Le CReSTIC de l'Université de Reims est spécialisé dans l'analyse d'images médicales, la simulation et la visualisation 3D. Enfin, l'Institut Pascal de Clermont-Ferrand apporte son expertise sur l'analyse et la segmentation des vaisseaux sanguins du foie.

Afin de juger de la qualité des algorithmes de segmentation, et en particulier leur adéquation avec une utilité clinique, deux radiologues du CHU de Clermont-Auvergne ont rejoint le projet. Ceux-ci sont aussi en charge de la collecte des données nécessaires au projet.

L'entreprise Kitware Inc. est spécialisée dans le développement d'outils algorithmiques et de visualisation pour l'imagerie médicale. Elle propose ainsi plusieurs outils \textit{open source} tels que l'aide à la compilation CMAKE, la librairie de traitement d'images médicales ITK, la librairie de visualisation 3D VTK ou encore la plateforme de visualisation Girder. Deux ingénieurs, issus de la branche Kitware de Lyon, participent à la dissémination du projet en intégrant les algorithmes développés aux outils existants de l'entreprise. Cette intégration passe en particulier par l'intégration d'un plug-in d'annotation et d'extraction des vaisseaux au logiciel de visualisation 3DSlicer. Cet outil \textit{open source} permet d'assurer une visibilité et surtout une utilisation internationale des algorithmes du projet.

\begin{figure}[ht]
    \centering
    \includegraphics[height=6cm]{Images/labs.png}
    \caption{Structures participant au projet ANR R-Vessel-X.}
    \label{fig:labs}
  \end{figure}

% Apports de la thèse
\section{Résumé de la thèse et apports}
\label{sec:introduction:résumé}

Cette thèse est dirigée par Bertrand Kerautret, professeur au LIRIS, et Nicolas Passat, professeur au CReSTIC. Elle est co-encadrée par Odyssée Merveille, maître de conférences du laboratoire d'imagerie médicale CREATIS qui  est rattaché à l'Université de Lyon et l'INSA de Lyon. L'objectif initial de cette thèse était la segmentation des vaisseaux du foie dans des images 3D. La segmentation des vaisseaux sanguins dans cet organe reste un problème ouvert, que ce soit en IRM ou en TDM. En effet, les vaisseaux hépatiques sont des structures dont le nombre de voxels est faible par rapport à l'ensemble de l'image. Ils sont, de plus, difficilement identifiables par leur apparence bruitée et faiblement contrastées en plus d'être des structures fines, dont la taille peut approcher les limites de la résolution des images.

Un premier objectif a donc été d'identifier un ensemble de méthodes d'extraction existantes capables d'être efficaces dans ce contexte difficile. La famille des filtres de rehaussement de vaisseaux semblait apporter une réponse à la plupart de nos problématiques. Ces filtres interviennent en amont de la segmentation. Ils permettent notamment de faire ressortir les structures tubulaires, et donc les vaisseaux, dans des contextes variés (Fig. \ref{fig:enhancement_example}). La littérature concernant ces filtres est variée avec une dizaine de filtres proposant des solutions complémentaires aux problématiques de la détection des vaisseaux sanguins. Pourtant, une analyse plus fine de la littérature montre qu'en pratique, la plupart des chaines de segmentation utilisent l'un des premiers filtres proposés dans la littérature : le filtre de Frangi \cite{Frangi1998_vesselness}. De plus, dans la plupart des articles, ce filtre est utilisé avec ses paramètres par défaut suggérés par Frangi en 1998, sans étudier si cette paramétrisation est adéquate pour la tâche concernée.

\begin{figure}
  % Frangi
  \centering
  \includegraphics[clip = true, trim  =  10 150 10 150, width=0.46\textwidth]{Images/Ircad_original_volume.png}
  \includegraphics[clip = true, trim  =  10 150 10 150, width=0.46\textwidth]{Images/Ircad_GT.png}
  \\
  \includegraphics[clip = true, trim  =  10 150 10 150, width=0.46\textwidth]{Images/Ircad_Frangi.png}
  \includegraphics[clip = true, trim  =  10 150 10 150, width=0.46\textwidth]{Images/Ircad_Jerman.png}
  \caption{Image du foie en TDM et deux exemples de rehaussement. De gauche à droite et de haut en bas : image originale, vérité terrain, filtre de Frangi et filtre de Jerman}
  \label{fig:enhancement_example}
  \end{figure}

On peut donc légitimement se poser plusieurs questions. Le filtre de Frangi est-il le filtre le mieux adapté pour toutes les tâches de rehaussement de vaisseaux ? Est-ce qu'un filtre est plus adapté à une modalité particulière ? Les filtres plus récents proposent-ils un rehaussement de meilleure qualité ? Quel est l'impact réel de la paramétrisation des filtres sur le rehaussement final ?

Malheureusement, les bancs de tests qui étudient seulement la qualité du rehaussement de vaisseaux sont peu nombreux et non extensibles. Leurs travaux ne peuvent donc pas être repris, soit parce que le code original n'est pas disponible, soit parce que les données ne sont pas publiques ou les deux en même temps. Dans l'esprit de robustesse du projet R-Vessel-X nous avons proposé les contributions suivantes :

\begin{itemize}
\item la collecte, l'implémentation et la mise à jour en C++ d'une sélection de filtres de rehaussement parmi les méthodes développées ces vingt dernières années. Chacun de ces filtres illustre une réponse à une problématique distincte du rehaussement de vaisseau ;
\item un outil de comparaison de méthodes de rehaussement modulable permettant de comparer le rehaussement dans des zones spécifiques définies par l'utilisateur ;
\item une analyse quantitative poussée de ces filtres en fonction de la hiérarchie des vaisseaux définie par leurs tailles et leurs jonctions ;
\item une analyse qualitative liant le choix des paramètres des méthodes à la réponse théorique des filtres et leur impact sur le rehaussement ;
\item une démonstration en ligne permettant de tester les filtres et leurs paramètres sans installation préalable et sur ses propres données ;
\item un outil d'annotation spécialisé pour la segmentation du foie, ainsi qu'une série de bases de données publiques retravaillées pour répondre à un manque de données annotées.
\end{itemize}

Ce travail a été réalisé dans un esprit de partage pour la communauté. C'est pourquoi une attention particulière a été apportée pour que ces travaux puissent être réutilisés et étendus par d'autres chercheurs, afin que ceux-ci n'aient pas à commencer leurs expériences à partir de zéro.

Ce manuscrit est organisé en \chapTotal{} chapitres : 

\begin{itemize}
\item Le chapitre \chapContextN{} présente le contexte clinique et scientifique de cette thèse. Celui-ci détaille l'anatomie du foie et présente les deux méthodes principales pour acquérir des images de manière non invasives ainsi que les différents artefacts liés à cette acquisition. Enfin, il introduit les bases de données publiques et leur intérêt dans le contexte de cette thèse.

\item Le chapitre \chapSOTAN{} introduit le rehaussement de vaisseaux. Il commence par résumer les besoins nés de la visualisation des données médicales, puis présente le contexte de la segmentation de vaisseaux afin de comprendre le positionnement du rehaussement. Il explique ensuite les concepts sur lesquel repose le rehaussement : les espaces multi-échelles et les caractéristiques de tubularité. Les espaces multi-échelles permettent de capturer les structures de l'image de différentes tailles tandis que la caractérisation de la tubularité permet de ne sélectionner que les vaisseaux.

\item Dans le chapitre \chapBenchN, nous discutons de la construction d'un banc de test afin d'évaluer les filtres de rehaussement. Ce chapitre décrit également les traitements des jeux de données nécessaires à l'évaluation des filtres et les choix qui ont guidé les principes de fonctionnement de cet outil.

\item Le chapitre \chapAnalysisN{} illustre l'utilisation de ce banc de test par une analyse des performances de sept filtres de rehaussements à travers cinq jeux de données différents (TDM, IRM et trois jeux d'IRM synthétique). Cette analyse étudie à la fois les performances des filtres les uns par rapport aux autres et l'influence de leur paramétrisation sur le résultat final de manière quantitative et qualitative. L'évaluation est menée sur le rehaussement pris au niveau de l'organe, sur le voisinage des vaisseaux de différentes tailles et sur leurs bifurcations. 

\item Nous discutons ensuite dans le chapitre \chapReproN{} de la reproductibilité de nos travaux ainsi que du travail mené pour promouvoir leur diffusion. Cette diffusion passe par la promotion de nos travaux par des publications en journaux et en conférences, mais aussi par le développement de démonstrateurs et de \plugIns{} pour un logiciel de visualisation 3D.

\item Enfin le chapitre \chapEndN, propose un bilan ainsi que des perspectives liées à ces travaux. Nous montrons en particulier l'intérêt du rehaussement pour les méthodes de segmentation populaires de nos jours, puis nous explorons la possibilité de baser la segmentation des vaisseaux sur la seule annotation des bifurcations.
\end{itemize}
    